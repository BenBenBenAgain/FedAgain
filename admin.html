<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fed Again ‚Äî Admin QR Generator</title>

<style>
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: #ffffff;
  margin: 0;
  padding: 40px 20px;
  color: #111;
}

.wrap {
  max-width: 720px;
  margin: 0 auto;
}

h1 {
  text-align: center;
  margin-bottom: 30px;
}

.card {
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
}

input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-size: 16px;
  margin-bottom: 14px;
}

button {
  padding: 14px 18px;
  border-radius: 12px;
  border: 1px solid #111;
  background: #fff;
  font-weight: 600;
  cursor: pointer;
  margin-right: 10px;
}

button:hover {
  background: #f3f4f6;
}

.ok {
  color: #047857;
  margin-top: 10px;
}

.error {
  color: #b91c1c;
  margin-top: 10px;
}

.magnetPreview {
  text-align: center;
  margin-top: 20px;
}

.magnetTitle {
  font-size: 32px;
  font-weight: 800;
  margin-bottom: 20px;
}

.magnetLabel {
  font-size: 20px;
  font-weight: 700;
  margin-top: 20px;
  letter-spacing: 0.06em;
}

.magnetBrand {
  font-size: 12px;
  margin-top: 10px;
  letter-spacing: 0.35em;
  color: #6b7280;
}
</style>
</head>

<body>
<div class="wrap">

<h1>Fed Again ‚Äî Admin QR Generator</h1>

<div class="card">
  <input id="label" placeholder="Household label (e.g. Pawsha's Fridge)" />
  <input id="secret" type="password" placeholder="Admin secret" />
  <button id="createBtn">Create household + QR</button>
  <div id="status"></div>
</div>

<div id="result" class="card" style="display:none;">
  <div><strong>Household URL</strong></div>
  <div id="url"></div>
  <br/>
  <button id="printBtn">Print Fridge Magnet</button>

  <div class="magnetPreview">
    <div class="magnetTitle">Has üê∂ been Fed? Walked?</div>
    <img id="qrImg" width="260" />
    <div id="printLabel" class="magnetLabel"></div>
    <div class="magnetBrand">FED AGAIN</div>
  </div>
</div>

</div>

<script>
const $label = document.getElementById("label");
const $secret = document.getElementById("secret");
const $createBtn = document.getElementById("createBtn");
const $status = document.getElementById("status");

const $result = document.getElementById("result");
const $url = document.getElementById("url");
const $qrImg = document.getElementById("qrImg");
const $printLabel = document.getElementById("printLabel");
const $printBtn = document.getElementById("printBtn");

async function createHousehold() {
  $status.textContent = "";
  $status.className = "";

  try {
    const res = await fetch("/api/create-household", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-admin-secret": $secret.value
      },
      body: JSON.stringify({
        label: $label.value
      })
    });

    const data = await res.json();

    if (!res.ok) {
      throw new Error(data.error || "Request failed");
    }

    $result.style.display = "block";
    $url.textContent = data.url;
    $qrImg.src = data.qrPngUrl;
    $printLabel.textContent = ($label.value || "").toUpperCase();

    $status.textContent = "Created. Print it and stick it on the fridge.";
    $status.className = "ok";

  } catch (err) {
    $status.textContent = err.message;
    $status.className = "error";
  }
}

function printMagnet() {
  window.print();
}

$createBtn.addEventListener("click", createHousehold);
$printBtn.addEventListener("click", printMagnet);
</script>

</body>
</html>
